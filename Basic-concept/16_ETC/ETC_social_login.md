# ì†Œì…œ ë¡œê·¸ì¸

<br>

## **# ì†Œì…œ ë¡œê·¸ì¸ì´ë€?**

<br>

ì†Œì…œë¡œê·¸ì¸ì€ ëª¨ë°”ì¼ì´ë‚˜ ì›¹ì—ì„œ ê°„í¸í•˜ê²Œ ë¡œê·¸ì¸í•˜ê¸° ìœ„í•œ ë°©ë²• ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤. ì†Œì…œë¡œê·¸ì¸ì„ ì‚¬ìš©í•˜ë©´ ë³„ë„ì˜ íšŒì›ê°€ì… ì ˆì°¨ ì—†ì´ ì†Œì…œë¯¸ë””ì–´ ê³„ì •ìœ¼ë¡œ ê°„í¸í•˜ê²Œ ë¡œê·¸ì¸ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

ì†Œì…œë¡œê·¸ì¸ì˜ ì¥ì ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

- íšŒì›ê°€ì… ì ˆì°¨ ì—†ì´ ê°„í¸í•˜ê²Œ ë¡œê·¸ì¸ ê°€ëŠ¥
- ë³´ì•ˆì„±ì´ ë†’ì•„ì ¸ ê°œì¸ì •ë³´ ìœ ì¶œ ê°€ëŠ¥ì„±ì´ ì¤„ì–´ë“­ë‹ˆë‹¤.
- ë‹¤ì–‘í•œ í”Œë«í¼ì—ì„œ ë™ì¼í•œ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.

í•˜ì§€ë§Œ ì†Œì…œë¡œê·¸ì¸ì„ ì‚¬ìš©í•˜ë©´ ë‚˜ì¤‘ì— ì†Œì…œë¯¸ë””ì–´ ê³„ì •ì„ ì‚­ì œí•˜ê²Œ ë˜ë©´ í•´ë‹¹ ì„œë¹„ìŠ¤ì—ì„œ ì‚¬ìš©í•˜ë˜ ê³„ì •ë„ í•¨ê»˜ ì‚­ì œë˜ë¯€ë¡œ ì£¼ì˜í•´ì•¼ í•©ë‹ˆë‹¤.

ë˜í•œ, ì†Œì…œë¡œê·¸ì¸ì„ ì‚¬ìš©í•˜ë©´ í•´ë‹¹ ì„œë¹„ìŠ¤ì—ì„œ ì œê³µí•˜ëŠ” ì •ë³´ë¥¼ ìˆ˜ì§‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ì´ë¥¼ ê¼­ í™•ì¸í•˜ê³  ë™ì˜í•œ ë’¤ì— ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

ì†Œì…œë¡œê·¸ì¸ì€ Facebook, Google, Twitter ë“± ë‹¤ì–‘í•œ ì†Œì…œë¯¸ë””ì–´ í”Œë«í¼ì—ì„œ ì§€ì›ë©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ëª¨ë“  ì„œë¹„ìŠ¤ì—ì„œ ëª¨ë“  ì†Œì…œë¯¸ë””ì–´ í”Œë«í¼ì„ ì§€ì›í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ, ì†Œì…œë¡œê·¸ì¸ì„ ì‚¬ìš©í•˜ë ¤ë©´ í•´ë‹¹ ì„œë¹„ìŠ¤ê°€ ì§€ì›í•˜ëŠ” ì†Œì…œë¯¸ë””ì–´ í”Œë«í¼ì„ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤.

<br>
<br>

## **# ì†Œì…œë¡œê·¸ì¸ ê¸°íš**

![ETC_social_login_01](https://github.com/Yu-jae-min/Basic-concept/assets/85284246/7426227b-3c4f-4f2d-8597-efca3416437b)

<br>
<br>

## **# ì†Œì…œë¡œê·¸ì¸ êµ¬í˜„ í”Œë¡œìš°**

<br>

### **# ì• í”Œ (apply)**

![ETC_social_login_02](https://github.com/Yu-jae-min/Basic-concept/assets/85284246/a01d085f-4ce4-4b9b-be42-ea6c87525ae2)

(1) í´ë¼ì´ì–¸íŠ¸ê°€ íŒŒë¦¬ë¯¸í„°ëŸ¬ í´ë¼ì´ì–¸íŠ¸ ID, ë¦¬ë‹¤ì´ë ‰íŠ¸ URI, ì‘ë‹µ íƒ€ì…ì„ codeë¡œ ì§€ì •í•˜ì—¬ ê¶Œí•œ ì„œë²„ì— ì „ë‹¬í•©ë‹ˆë‹¤. ì •ìƒì ìœ¼ë¡œ ì¸ì¦ì´ ë˜ë©´ ê¶Œí•œ ì½”ë“œ ë¶€ì—¬ ì½”ë“œë¥¼ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ë³´ëƒ…ë‹ˆë‹¤.ì‘ë‹µ íƒ€ì…ì€ code, token ì´ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.ì‘ë‹µ íƒ€ì…ì´ token ì¼ ê²½ìš° ì•”ì‹œì  ìŠ¹ì¸ íƒ€ì…ì— í•´ë‹¹í•©ë‹ˆë‹¤.

(2) ì‘ë‹µ í•´ì¤€ Access Token ì´ ìœ íš¨í•œì§€ ê²€ì¦ ìš”ì²­ì„ í•©ë‹ˆë‹¤.

(3) ìš”ì²­ ë°›ì€ Access Token ì •ë³´ì— ëŒ€í•œ ê²€ì¦ì— ëŒ€í•œ ì‘ë‹µê°’ì„ ëŒë ¤ì¤ë‹ˆë‹¤.

(4) ìœ íš¨í•œ Access Token ê¸°ë°˜ìœ¼ë¡œ Resource Serverì™€ í†µì‹ í•©ë‹ˆë‹¤.

> 3ë²ˆì—ì„œ ì• í”Œë¡œê·¸ì¸ì—ì„œëŠ” clientsecretë¥¼ key.p8 íŒŒì¼ì„ ì´ìš©í•´ ì•”í˜¸í™”í•´ì„œ ì• í”Œ ì„œë²„ì— ìš”ì²­, ê·¸ë¦¬ê³  ë°›ì€ ê²°ê³¼ê°’ì€ jwtë¥¼ ì´ìš©í•´ í’€ì–´ì•¼í•œë‹¤. ë˜í•œ client_secret ê°’ì€ 180ì¼ì— í•œë²ˆì”© ì—…ë°ì´íŠ¸ë¥¼ í•´ì•¼í•œë‹¤.

<br>

### **# êµ¬ê¸€ (google)**

![ETC_social_login_03](https://github.com/Yu-jae-min/Basic-concept/assets/85284246/e8354362-a4a9-46ef-a24e-14d20a64b629)

![ETC_social_login_04](https://github.com/Yu-jae-min/Basic-concept/assets/85284246/427b9856-ec16-41c3-bc37-5608bf94b296)

<br>
<br>

## **# êµ¬í˜„ ë°©ë²•**

<br>

### **# ì• í”Œ (apple)**

1. [ì• í”Œ ê°œë°œì í™ˆí˜ì´ì§€ ì ‘ì†](https://developer.apple.com/)
2. [ App ID ë“±ë¡ ] ì¢Œì¸¡ ë©”ë‰´ ì¤‘ Identifiers - App ID ìƒì„± (ì• í”Œ ê°œë°œì í˜ì´ì§€ì— iOS ì•±ì„ ë“±ë¡í•˜ì§€ ì•Šì•˜ì„ ê²½ìš°ì—ë§Œ ìˆ˜í–‰) - Identifiers íƒ€ì´í‹€ ì˜† + ë²„íŠ¼ - App IDs ì„ íƒ - ë“±ë¡í•  iOS ì•± í”„ë¡œì íŠ¸ì˜ Bundle IDë¥¼ ì…ë ¥ - Capabilities ëª©ë¡ì—ì„œ Sign In with Appleì„ ì„ íƒí•˜ê³  Edit - Enable as a primary App ID ì„ íƒ, ì¼ì¢…ì˜ ë¡œê·¸ì¸ì„ ê³µìœ í•œë‹¤ëŠ” ê°œë…ì¸ë° ë‚´ê°€ ê°€ì§„ ë‹¤ë¥¸ì•±ê³¼ ìƒê´€ì—†ëŠ” ë…ë¦½ì ì¸ ì•±ì´ë¼ë©´ Enable as a primary App IDë¥¼ ì„ íƒí•˜ê³  ì €ì¥í•˜ì—¬ App ID ë“±ë¡ ì ˆì°¨ ì™„ë£Œ
3. [ Key ë°œê¸‰ ] ì¢Œì¸¡ ë©”ë‰´ ì¤‘ Keys - Keys íƒ€ì´í‹€ ì˜† + ë²„íŠ¼ - Key ì´ë¦„ ì…ë ¥ í›„ Sign In with Appleì„ í™œì„±í™” ë° ìš°ì¸¡ Configure ë²„íŠ¼ í´ë¦­ - ë“œë¡­ë‹¤ìš´ ì—´ì–´ì„œ App ID ì„ íƒ - ë§ˆì§€ë§‰ ë‹¨ê³„ì—ì„œ private key íŒŒì¼ ë‹¤ìš´ë¡œë“œ, ì£¼ì˜í•  ì ì€ ì¬ë‹¤ìš´ë¡œë“œê°€ ë¶ˆê°€í•˜ë¯€ë¡œ ë°”ë¡œ ë‹¤ìš´ë¡œë“œí•´ì•¼í•˜ë©° ë¶„ì‹¤ ì‹œ Keyë¥¼ ìƒˆë¡œ ìƒì„±í•´ì•¼ í•¨
4. [ Service ID ] ì›¹ì—ì„œ ì• í”Œë¡œê·¸ì¸ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ service ID í™œì„±í™”í•´ì•¼ í•¨, Identifiers íƒ€ì´í‹€ ì˜† + ë²„íŠ¼ - Services IDs ì„ íƒ - Identifierë¥¼ ì§€ì–´ì¤€ë‹¤.Â ë³´í†µ App ID(Bundle ID)ë¥¼ ì—­ìˆœìœ¼ë¡œ ë°°ì¹˜í•´ì„œ ì“´ë‹¤. App IDê°€Â *aaa.bbb.ccc*ë©´Â *ccc.bbb.aaa*ë¡œ ì§€ì–´ì£¼ë©´ ëœë‹¤. ê·¸ í›„ Sign In with Appleì„ í™œì„±í™” í•´ì£¼ê³  Configure ë²„íŠ¼ì„ í´ë¦­ - ì• í”Œ ë¡œê·¸ì¸ë„ ì¼ì¢…ì˜ OAuth ì¸ì¦ì´ê¸° ë•Œë¬¸ì— ë¡œê·¸ì¸ í™”ë©´ì—ì„œ ìˆ˜í–‰í•œ ê²°ê³¼ë¥¼ ë°±ì—”ë“œ ì„œë²„ë¡œ ì „ë‹¬í•˜ëŠ”ë° ìœ„ ì°½ì—ëŠ” ê·¸ ê²°ê³¼ë¥¼ ì „ë‹¬ë°›ì„ ë„ë©”ì¸ê³¼ í•˜ìœ„ ì£¼ì†Œë¥¼ ì…ë ¥, ë§Œì•½, ë‚´ê°€Â *test.com*ë¼ëŠ” ë„ë©”ì¸ì˜Â *callback/apple*Â ì´ë¼ëŠ” ì£¼ì†Œë¡œ ê²°ê³¼ë¥¼ ì „ë‹¬ë°›ê³  ì‹¶ë‹¤ë©´ Web Domainì—ëŠ”Â *test.com*ì„, Return URLsì—ëŠ”Â *https://test.com/callback.apple*ì„ ì…ë ¥í•´ì£¼ë©´ ëœë‹¤. ì°¸ê³ ë¡œ localhostë„ ì•ˆë˜ë©°, HTTPê°€ ì•„ë‹Œ ì»¤ìŠ¤í…€ í”„ë¡œí† ì½œ(ì˜ˆë¥¼ë“¤ì–´ markets://)ë„ ì•ˆëœë‹¤. ë‹¤ ì…ë ¥í–ˆìœ¼ë©´ Saveë¥¼ ëˆ„ë¥´ê³  ë‹¤ì‹œ Configureë¥¼ ëˆŒëŸ¬ì„œ ìœ„ ì°½ì„ í•œ ë²ˆ ë” ë„ì›Œì¤€ë‹¤. ì…ë ¥ì„ ì™„ë£Œí•˜ë©´ Download, Verify ë²„íŠ¼ì´ ìƒê¸´ë‹¤. Download ë²„íŠ¼ì„ ëˆŒëŸ¬Â *apple-developer-domain-association.txt*ë¥¼ ë‹¤ìš´ë°›ê³ Â */.well-known*Â ì£¼ì†Œ ì•„ë˜ì— í•´ë‹¹ íŒŒì¼ì„ í˜¸ìŠ¤íŒ…í•œë‹¤. í˜¸ìŠ¤íŒ…ì„ ë§ˆì³¤ë‹¤ë©´ Verify ë²„íŠ¼ì„ ëˆ„ë¥¸ë‹¤. ì´ í›„ ì´ˆë¡ ví‘œì‹œê°€ ìƒê¸°ë©´ ì™„ë£Œ

> **ë‚´ iOS ì•±ì— ì• í”Œ ë¡œê·¸ì¸ ê¸°ëŠ¥ì„ ë„£ì–´ì•¼ í•˜ëŠ” ì´ìœ ** : ì• í”Œì´ WWDC 2019ì—ì„œ ì• í”Œ ë¡œê·¸ì¸(Sign In with Apple) ê¸°ëŠ¥ì„ ë°œí‘œí•¨ê³¼ ë™ì‹œì—, êµ¬ê¸€ì´ë‚˜ í˜ì´ìŠ¤ë¶ ë¡œê·¸ì¸ê³¼ ê°™ì´ íƒ€ì‚¬ ì¸ì¦(OAuth)ì„ ì§€ì›í•˜ëŠ” iOS ì•±ì— ì• í”Œ ë¡œê·¸ì¸ì„ ê°•ì œë¡œ ë„£ì–´ì•¼ í•œë‹¤ëŠ” ì¡°í•­ì„ ë‚´ê±¸ì—ˆë‹¤. ìš°ì™•êµ³

<br>

### **# í˜ì´ìŠ¤ë¶ (facebook)**

- ì°¸ê³  URL : https://imweb.me/faq?mode=view&category=29&category2=47&idx=71636

  ```js
  import FacebookProvider from "next-auth/providers/facebook";
  ...
  providers: [
    FacebookProvider({
      clientId: process.env.FACEBOOK_CLIENT_ID,
      clientSecret: process.env.FACEBOOK_CLIENT_SECRET
    })
  ]
  ...
  ```

<br>

### **# êµ¬ê¸€ (google)**

1. [êµ¬ê¸€ í´ë¼ìš°ë“œ í”Œë«í¼](https://console.cloud.google.com/getting-started?pli=1) ì ‘ì†
2. ìƒë‹¨ í”„ë¡œì íŠ¸ ì„ íƒ - í”„ë¡œì íŠ¸ ìƒì„±
3. API ë° ì„œë¹„ìŠ¤ - ì‚¬ìš©ì ì¸ì¦ ì •ë³´
4. ìƒë‹¨ ì‚¬ìš©ì ì¸ì¦ ì •ë³´ ë§Œë“¤ê¸° - OAuth í´ë¼ì´ì–¸íŠ¸ ID - ë™ì˜ í™”ë©´ êµ¬ì„±, ëª©ì ì— ë”°ë¥¸ ë‚´ë¶€/ì™¸ë¶€ ì„ íƒ (ë‚´ë¶€ëŠ” ì¡°ì§ ë‚´ G Suite ì‚¬ìš©ìë§Œ í—ˆìš©í•˜ë©° ì™¸ë¶€ëŠ” ëª¨ë“  ì‚¬ìš©ì í—ˆìš©í•˜ëŠ”ë° ìš°ë¦¬ ì„œë¹„ìŠ¤ì—ì„œëŠ” ì¼ë°˜ ì‚¬ìš©ìê°€ ëŒ€ìƒì´ê¸° ë•Œë¬¸ì— ì™¸ë¶€ë¥¼ ì„ íƒ) í›„ ë§Œë“¤ê¸°
5. [ ì•± ë“±ë¡ ìˆ˜ì • step1 ] OAuth ë™ì˜ í™”ë©´ ê°œë°œì ì •ë³´ ì…ë ¥
6. [ ì•± ë“±ë¡ ìˆ˜ì • step2 ] ë²”ìœ„ ì¶”ê°€ ë˜ëŠ” ì‚­ì œ - ì „ë‹¬ë°›ê³ ì í•˜ëŠ” ì •ë³´ ì„ íƒ
7. [ ì•± ë“±ë¡ ìˆ˜ì • step3 ] í…ŒìŠ¤íŠ¸ ê³„ì • ë“±ë¡ - [ ì•± ë“±ë¡ ìˆ˜ì • step 4 ] ìš”ì•½ í™•ì¸ í›„ ë“±ë¡
8. ì•± ë“±ë¡ ì™„ë£Œ í›„ 4ì—ì„œ ì„ íƒí–ˆë˜ OAuth í´ë¼ì´ì–¸íŠ¸ ID ë‹¤ì‹œ í´ë¦­ - ì• í”Œë¦¬ì¼€ì´ì…˜ ìœ í˜•, ì´ë¦„, ë¡œê·¸ì¸ì´ ì‚¬ìš©ë  URL ì…ë ¥í•˜ì—¬ OAuth í´ë¼ì´ì–¸íŠ¸ ID ìƒì„±, í´ë¼ì´ì–¸íŠ¸ IDì™€ ë¹„ë°€ë²ˆí˜¸ëŠ” í™˜ê²½ ë³€ìˆ˜ì— ì¶”ê°€í•˜ì—¬ ì‚¬ìš©
9. í´ë¼ì´ì–¸íŠ¸ ì½”ë“œ ì‘ì„± (next-auth í˜¹ì€ react-google-login ë“± ì‚¬ìš©)

- example : next-auth

  ```js
  // next-auth ì‚¬ìš©ì‹œ pages/api/auth í´ë”ì•ˆì— [...nextauth].js íŒŒì¼ì„ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤.

  import NextAuth from "next-auth";
  import GoogleProvider from "next-auth/providers/google";

  const nextAuthOptions = (req, res) => {
    return {
      providers: [
        GoogleProvider({
          clientId: process.env.GOOGLE_CLIENT_ID,
          clientSecret: process.env.GOOGLE_CLIENT_SECRET,
        }),
      ],
    };
  };

  const authHandler = (req, res) => {
    return NextAuth(req, res, nextAuthOptions(req, res));
  };

  export default authHandler;
  ```

  ```js
  // ë¡œê·¸ì¸ í™”ë©´ì—ì„œ next-auth signIn í•¨ìˆ˜ë¥¼ ì´ìš©í•©ë‹ˆë‹¤.

  import { signIn } from 'next-auth/react';

  const Login = () => {

    ... ìƒëµ

    return (
      <Button onClick={() => signIn('google')}>
        êµ¬ê¸€ ë¡œê·¸ì¸
      </Button>
    );
  }
  ```

- example : react-google-login

  ```js
  // index.tsx
  import * as React from "react";
  import { NextPage } from "next";
  import styled from "styled-components";
  import Router from "next/router";
  import GoogleLogin from "react-google-login";

  const Index: NextPage = () => {
    const onSuccess = (res: any) => {
      console.log(res); // ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ

      Router.push("/google"); // /google í˜ì´ì§€ë¡œ ì´ë™
    };

    const onFailure = (error: any) => {
      console.log(error);
    };

    return (
      <Wrapper>
        <Header.Container>
          <Header.Title>ë¡œê·¸ì¸í•  ë°©ë²•ì„ ì„ íƒí•´ì£¼ì„¸ìš”.</Header.Title>
        </Header.Container>

        <Button.Container>
          <Button.ButtonList>
            <Button.GoogleButton
              clientId="asdf12345.apps.googleusercontent.com" // ë°œê¸‰ëœ clientId ë“±ë¡
              onSuccess={onSuccess}
              onFailure={onFailure}
              cookiePolicy={"single_host_origin"} // ì¿ í‚¤ ì •ì±… ë“±ë¡
              buttonText="Google ë¡œê·¸ì¸" // ë²„íŠ¼ì— ì‚¬ìš©ë  í…ìŠ¤íŠ¸
            />
          </Button.ButtonList>
        </Button.Container>
      </Wrapper>
    );
  };

  export default Index;

  const Wrapper = styled.div`
    max-width: 720px;

    margin: 0 auto;
  `;

  const Header = {
    Container: styled.div`
      text-align: center;
    `,

    Title: styled.h2``,
  };

  const Button = {
    Container: styled.div``,

    ButtonList: styled.div`
      display: flex;
      flex-direction: column;
      align-items: center;
    `,

    GoogleButton: styled(GoogleLogin)`
      width: 360px;
      height: 40px;

      margin: 6px 0;

      justify-content: center;

      & span {
        font-size: 18px;
        font-weight: 700 !important;
      }
    `,
  };
  ```

  ```js
  // google.tsx
  import { NextPage } from "next";
  import Router from "next/router";
  import * as React from "react";
  import styled from "styled-components";
  import { GoogleLogout } from "react-google-login";

  const Google: NextPage = () => {
    const onLogoutSuccess = () => {
      console.log("onLogoutSuccess");

      Router.push("/");
    };

    const onFailure = () => {
      console.log("onFailure");
    };

    return (
      <Wrapper>
        <Title>Google Page...</Title>
        <Button
          clientId="asdf12345.apps.googleusercontent.com" // ë°œê¸‰ëœ clientId ë“±ë¡
          onLogoutSuccess={onLogoutSuccess}
          onFailure={onFailure}
          buttonText="Google ë¡œê·¸ì•„ì›ƒ" // ë²„íŠ¼ì— ì‚¬ìš©ë  í…ìŠ¤íŠ¸
        />
      </Wrapper>
    );
  };

  export default Google;

  const Wrapper = styled.div`
    max-width: 720px;

    margin: 0 auto;

    display: flex;
    flex-direction: column;
    align-items: center;
  `;

  const Title = styled.h2``;

  const Button = styled(GoogleLogout)`
    width: 360px;
    height: 40px;

    margin: 6px 0;

    justify-content: center;

    & span {
      font-size: 18px;
      font-weight: 700 !important;
    }
  `;
  ```

<br>

## **# ì°¸ê³  ìë£Œ**

- [OAuth 2.0 (Open Authorization)](https://tecoble.techcourse.co.kr/post/2021-07-10-understanding-oauth/)
- [react-google-login](https://github.com/anthonyjgrove/react-google-login)
- [next-auth official homepage](https://next-auth.js.org/)
- [next-auth github](https://github.com/nextauthjs/next-auth) : apple, google, facebook ëª¨ë‘ ì§€ì› ğŸ˜®
  - apple : https://next-auth.js.org/providers/apple
  - facebook : https://next-auth.js.org/providers/facebook
  - google : https://next-auth.js.org/providers/google
- [google one tab login](https://tilnote.io/pages/63b6a5b0eb6139cc0588447f)
- [JavaScript SDKë¥¼ ì‚¬ìš©í•˜ëŠ” ì›¹ìš© Facebook ë¡œê·¸ì¸](https://developers.facebook.com/docs/facebook-login/web)
